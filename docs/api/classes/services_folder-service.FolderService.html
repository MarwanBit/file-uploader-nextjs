<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>FolderService | File Uploader Next.js - API Documentation - v0.1.0</title><meta name="description" content="Documentation for File Uploader Next.js - API Documentation"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">File Uploader Next.js - API Documentation - v0.1.0</a><div id="tsd-toolbar-links"><a href="https://github.com/marwanbit/file-uploader-nextjs">GitHub</a></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="../modules/services_folder-service.html">services/folder-service</a></li><li><a href="" aria-current="page">FolderService</a></li></ul><h1>Class FolderService</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><p>Service class for managing folder operations including S3 storage and database persistence</p>
</div><div class="tsd-comment tsd-typography"><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks">Remarks<a href="#remarks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This service provides a centralized interface for all folder-related operations, including:</p>
<ul>
<li>create a &quot;root Folder&quot; for the user, where all subsequent folders are placed</li>
<li>Deleting folders recursively from the database</li>
<li>managing folder share</li>
<li>Managing folder permission</li>
</ul>
<p>All methods in this service are static and handle their own error management</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example">Example<a href="#example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Create the rootFolder for a user</span><br/><span class="hl-1">const</span><span class="hl-2"> { </span><span class="hl-3">userId</span><span class="hl-2"> } = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">auth</span><span class="hl-2">();</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">client</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">clerkClient</span><span class="hl-2">();</span><br/><span class="hl-1">let</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2">.</span><span class="hl-7">users</span><span class="hl-2">.</span><span class="hl-5">getUser</span><span class="hl-2">(</span><span class="hl-7">userId</span><span class="hl-2">);</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">root_folder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">createRootFolder</span><span class="hl-2">(</span><span class="hl-7">user</span><span class="hl-2">, </span><span class="hl-7">userId</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div></div></section><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L29">src/services/folder-service.ts:29</a></li></ul></aside><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><details class="tsd-index-content tsd-accordion" open><summary class="tsd-accordion-summary tsd-index-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h5 class="tsd-index-heading uppercase">Index</h5></summary><div class="tsd-accordion-details"><section class="tsd-index-section"><h3 class="tsd-index-heading">Constructors</h3><div class="tsd-index-list"><a href="#constructor" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Methods</h3><div class="tsd-index-list"><a href="#createrootfolder" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>create<wbr/>Root<wbr/>Folder</span></a>
<a href="#getfolder" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder</span></a>
<a href="#createsubfolder" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>create<wbr/>Subfolder</span></a>
<a href="#getfolderrecursively" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder<wbr/>Recursively</span></a>
<a href="#deletefolderrecursively" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>delete<wbr/>Folder<wbr/>Recursively</span></a>
<a href="#sharefolder" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>share<wbr/>Folder</span></a>
<a href="#uploadfiletofolder" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>upload<wbr/>File<wbr/>To<wbr/>Folder</span></a>
<a href="#getancestors" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Ancestors</span></a>
<a href="#getfolderbysharetoken" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder<wbr/>By<wbr/>Share<wbr/>Token</span></a>
</div></section></div></details></section></section><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Constructors</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="constructor"><span>constructor</span><a href="#constructor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="constructorfolderservice"><span class="tsd-signature-keyword">new</span> <span class="tsd-kind-constructor-signature">FolderService</span><span class="tsd-signature-symbol">()</span><span class="tsd-signature-symbol">:</span> <a href="" class="tsd-signature-type tsd-kind-class">FolderService</a><a href="#constructorfolderservice" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><h4 class="tsd-returns-title">Returns <a href="" class="tsd-signature-type tsd-kind-class">FolderService</a></h4></div></li></ul></section></section></details><details class="tsd-panel-group tsd-member-group tsd-accordion" open><summary class="tsd-accordion-summary" data-key="section-Methods"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h2>Methods</h2></summary><section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="createrootfolder"><code class="tsd-tag">Static</code><span>create<wbr/>Root<wbr/>Folder</span><a href="#createrootfolder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="createrootfolder-1"><span class="tsd-kind-call-signature">createRootFolder</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">user</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">User</span><span class="tsd-signature-symbol">,</span> <span class="tsd-kind-parameter">userId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span><a href="#createrootfolder-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Generate the rootFolder for a user where all file and folder uploads are contained in.
Each user has a unique rootFolder whose name is the name of the folder.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">user</span>: <span class="tsd-signature-type">User</span></span><div class="tsd-comment tsd-typography"><p>The user object returned by Clerk's useUser() hooek</p>
</div></li><li><span><span class="tsd-kind-parameter">userId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The userId returned by clerks auth() hook</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to a folder object, the folder object for the rootFolder.</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws">Throws<a href="#throws" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>A race condition occurs where multiple requests to create the same root folder occur.</li>
<li>Database transcation fails</li>
<li>There's a failure communicating with Clerk, S3, or the DB</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-1">Example<a href="#example-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Create the rootFolder for a user</span><br/><span class="hl-1">const</span><span class="hl-2"> { </span><span class="hl-3">userId</span><span class="hl-2"> } = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">auth</span><span class="hl-2">();</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">client</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">clerkClient</span><span class="hl-2">();</span><br/><span class="hl-1">let</span><span class="hl-2"> </span><span class="hl-7">user</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">client</span><span class="hl-2">.</span><span class="hl-7">users</span><span class="hl-2">.</span><span class="hl-5">getUser</span><span class="hl-2">(</span><span class="hl-7">userId</span><span class="hl-2">);</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">root_folder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">createRootFolder</span><span class="hl-2">(</span><span class="hl-7">user</span><span class="hl-2">, </span><span class="hl-7">userId</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-1">Remarks<a href="#remarks-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>For some reason, even when testing with only one client there seems to be race conditions
which is why it is necessary to deal with them, hence the transactions and error handling.</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L66">src/services/folder-service.ts:66</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="getfolder"><code class="tsd-tag">Static</code><span>get<wbr/>Folder</span><a href="#getfolder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="getfolder-1"><span class="tsd-kind-call-signature">getFolder</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">folderId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span><a href="#getfolder-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Retrieves a folder's complete information including its files and subfolders.</p>
<p>This method fetches a folder by its unique identifier and includes all related
entities (files and subfolders) in a single query for efficiency.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">folderId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The unique identifier of the folder to retrieve</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to the Folder object with populated files and subfolders</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-1">Throws<a href="#throws-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if there's a database communication failure</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-2">Example<a href="#example-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">folder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getFolder</span><span class="hl-2">(</span><span class="hl-6">&#39;folder-123&#39;</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Folder name:&#39;</span><span class="hl-2">, </span><span class="hl-7">folder</span><span class="hl-2">.</span><span class="hl-7">folder_name</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Number of files:&#39;</span><span class="hl-2">, </span><span class="hl-7">folder</span><span class="hl-2">.</span><span class="hl-7">files</span><span class="hl-2">.</span><span class="hl-7">length</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Number of subfolders:&#39;</span><span class="hl-2">, </span><span class="hl-7">folder</span><span class="hl-2">.</span><span class="hl-7">subfolders</span><span class="hl-2">.</span><span class="hl-7">length</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-2">Remarks<a href="#remarks-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method uses Prisma's <code>include</code> feature to eagerly load related entities,
avoiding N+1 query problems. The returned folder will always include <code>files</code>
and <code>subfolders</code> arrays, even if they're empty.</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see">See<a href="#see" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#getfolderrecursively" class="tsd-kind-method">getFolderRecursively</a> for retrieving the entire folder tree</li>
<li><a href="../types/types_types.Folder.html" class="tsd-kind-type-alias">Folder</a> for the complete folder type definition</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L179">src/services/folder-service.ts:179</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="createsubfolder"><code class="tsd-tag">Static</code><span>create<wbr/>Subfolder</span><a href="#createsubfolder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="createsubfolder-1"><span class="tsd-kind-call-signature">createSubfolder</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">parent_folder</span><span class="tsd-signature-symbol">:</span> <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">folderName</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">root_folder</span><span class="tsd-signature-symbol">:</span> <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">userId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span><a href="#createsubfolder-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Creates a new subfolder within an existing parent folder.</p>
<p>This method creates a new folder in the database, generates a marker file in S3
to represent the folder structure, and updates the parent folder's relationships.
The folder path is constructed relative to the root folder.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">parent_folder</span>: <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a></span><div class="tsd-comment tsd-typography"><p>The folder that will contain this new subfolder</p>
</div></li><li><span><span class="tsd-kind-parameter">folderName</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The name for the new subfolder</p>
</div></li><li><span><span class="tsd-kind-parameter">root_folder</span>: <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a></span><div class="tsd-comment tsd-typography"><p>The user's root folder (used for path construction)</p>
</div></li><li><span><span class="tsd-kind-parameter">userId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The Clerk user ID of the folder owner</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to the newly created Folder object</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-2">Throws<a href="#throws-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>The database insertion fails (e.g., duplicate folder name)</li>
<li>The S3 folder info file creation fails</li>
<li>The parent folder update fails</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-3">Example<a href="#example-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-1">const</span><span class="hl-2"> { </span><span class="hl-3">userId</span><span class="hl-2"> } = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-5">auth</span><span class="hl-2">();</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">parentFolder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getFolder</span><span class="hl-2">(</span><span class="hl-6">&#39;parent-id&#39;</span><span class="hl-2">);</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">rootFolder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getFolder</span><span class="hl-2">(</span><span class="hl-7">user</span><span class="hl-2">.</span><span class="hl-7">publicMetadata</span><span class="hl-2">.</span><span class="hl-7">root_folder</span><span class="hl-2">);</span><br/><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">newFolder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">createSubfolder</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-7">parentFolder</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">&#39;My Documents&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">rootFolder</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">userId</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Created folder:&#39;</span><span class="hl-2">, </span><span class="hl-7">newFolder</span><span class="hl-2">.</span><span class="hl-7">folder_name</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;S3 path:&#39;</span><span class="hl-2">, </span><span class="hl-7">newFolder</span><span class="hl-2">.</span><span class="hl-7">s3_key</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-3">Remarks<a href="#remarks-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>This method performs several operations:</p>
<ol>
<li>Creates the folder record in the database</li>
<li>Generates an S3 path: <code>{rootFolderName}/{folderName}/.folder-info.txt</code></li>
<li>Creates a marker file in S3 with folder metadata</li>
<li>Updates the parent folder to include the new subfolder in its relationships</li>
</ol>
<p>The <code>.folder-info.txt</code> file serves as a marker in S3 since S3 doesn't have
native folder support. It also stores useful metadata about the folder.</p>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-1">See<a href="#see-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#createrootfolder" class="tsd-kind-method">createRootFolder</a> for creating the user's root folder</li>
<li>createFolderInfoFile for the S3 marker file creation logic</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L247">src/services/folder-service.ts:247</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="getfolderrecursively"><code class="tsd-tag">Static</code><span>get<wbr/>Folder<wbr/>Recursively</span><a href="#getfolderrecursively" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="getfolderrecursively-1"><span class="tsd-kind-call-signature">getFolderRecursively</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">folderId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">unknown</span><span class="tsd-signature-symbol">&gt;</span><a href="#getfolderrecursively-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><code class="tsd-tag">Beta</code><div class="tsd-comment tsd-typography"><p>Recursively retrieves a complete folder hierarchy starting from a given folder.</p>
<p>This method fetches a folder and all of its descendants (subfolders and their
subfolders, etc.) in a nested structure. It's particularly useful for rendering
folder trees or navigating the entire folder structure.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">folderId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The unique identifier of the folder to start from</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">unknown</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to:</p>
<ul>
<li>A nested object containing the folder with all subfolders recursively populated</li>
<li><code>null</code> if the folder doesn't exist</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-3">Throws<a href="#throws-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if there's a database communication failure</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-4">Example<a href="#example-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">folderTree</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getFolderRecursively</span><span class="hl-2">(</span><span class="hl-6">&#39;root-folder-id&#39;</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Structure returned:</span><br/><span class="hl-0">// {</span><br/><span class="hl-0">//   id: &#39;root-folder-id&#39;,</span><br/><span class="hl-0">//   folder_name: &#39;My Root&#39;,</span><br/><span class="hl-0">//   files: [...],</span><br/><span class="hl-0">//   subfolders: [</span><br/><span class="hl-0">//     {</span><br/><span class="hl-0">//       id: &#39;sub1&#39;,</span><br/><span class="hl-0">//       folder_name: &#39;Documents&#39;,</span><br/><span class="hl-0">//       files: [...],</span><br/><span class="hl-0">//       subfolders: [...]  // Recursively nested</span><br/><span class="hl-0">//     }</span><br/><span class="hl-0">//   ]</span><br/><span class="hl-0">// }</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-4">Remarks<a href="#remarks-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Performance Considerations:</strong></p>
<ul>
<li>This method makes N+1 database queries where N is the number of subfolders</li>
<li>For large folder hierarchies, this can be slow and expensive</li>
<li>Consider using pagination or limiting depth for production use</li>
<li>Future optimization could use recursive CTEs or graph queries</li>
</ul>
<p><strong>Data Structure:</strong></p>
<ul>
<li>Each folder includes: id, folder_name, is_root, created_at, updated_at, parent_folder_id</li>
<li>Files are included with: id, file_name, created_at</li>
<li>Subfolders are fully recursive (the entire tree is loaded)</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-2">See<a href="#see-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#getfolder" class="tsd-kind-method">getFolder</a> for fetching a single folder without recursion</li>
<li><a href="#deletefolderrecursively" class="tsd-kind-method">deleteFolderRecursively</a> for the recursive deletion counterpart</li>
</ul>
<p>The return type is currently <code>unknown</code> but should be typed as a recursive Folder interface
in a future version.</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L437">src/services/folder-service.ts:437</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="deletefolderrecursively"><code class="tsd-tag">Static</code><span>delete<wbr/>Folder<wbr/>Recursively</span><a href="#deletefolderrecursively" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="deletefolderrecursively-1"><span class="tsd-kind-call-signature">deleteFolderRecursively</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">folderId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span><a href="#deletefolderrecursively-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Recursively deletes a folder, all its subfolders, and all contained files.</p>
<p>This is a destructive operation that:</p>
<ol>
<li>Deletes all files in the current folder from both S3 and the database</li>
<li>Recursively deletes all subfolders and their contents</li>
<li>Deletes the folder's marker file from S3</li>
<li>Deletes the folder record from the database</li>
</ol>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">folderId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The unique identifier of the folder to delete</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves when the deletion is complete</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-4">Throws<a href="#throws-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>The folder is not found</li>
<li>Any S3 deletion fails</li>
<li>Any database deletion fails</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-5">Example<a href="#example-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">deleteFolderRecursively</span><span class="hl-2">(</span><span class="hl-6">&#39;folder-to-delete&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Folder and all contents deleted successfully&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-7">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">error</span><span class="hl-2">(</span><span class="hl-6">&#39;Failed to delete folder:&#39;</span><span class="hl-2">, </span><span class="hl-7">error</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-5">Remarks<a href="#remarks-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Deletion Order:</strong></p>
<ol>
<li>Files in the current folder (S3 then database)</li>
<li>All subfolders (recursive)</li>
<li>The folder's <code>.folder-info.txt</code> marker in S3</li>
<li>The folder record itself</li>
</ol>
<p><strong>Error Handling:</strong></p>
<ul>
<li>Individual file S3 deletion errors are logged but don't stop the process</li>
<li>Individual subfolder deletion errors are logged but don't stop the process</li>
<li>This ensures maximum cleanup even if some operations fail</li>
<li>However, the final folder deletion will fail if any child records remain</li>
</ul>
<p><strong>Performance:</strong></p>
<ul>
<li>This operation can be slow for large folder hierarchies</li>
<li>Consider implementing batch deletion for production use</li>
<li>Each file and folder requires separate S3 and database operations</li>
</ul>
<p><strong>Safety:</strong></p>
<ul>
<li>This operation is <strong>irreversible</strong> - there is no undo</li>
<li>Consider implementing soft delete or a &quot;trash&quot; folder for production</li>
<li>Consider adding authorization checks before calling this method</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-3">See<a href="#see-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#getfolderrecursively" class="tsd-kind-method">getFolderRecursively</a> for retrieving folder structure before deletion</li>
<li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/delete-objects.html">AWS S3 Delete Objects</a></li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L538">src/services/folder-service.ts:538</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="sharefolder"><code class="tsd-tag">Static</code><span>share<wbr/>Folder</span><a href="#sharefolder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="sharefolder-1"><span class="tsd-kind-call-signature">shareFolder</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">folderId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">hours</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">origin</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">expires_at</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Date</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">&gt;</span><a href="#sharefolder-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Creates a shareable link for a folder with a time-limited access token.</p>
<p>This method generates a unique share token, sets an expiration time, and returns
a complete URL that can be shared with others to provide temporary access to the
folder and all its contents (including subfolders and files).</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">folderId</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The unique identifier of the folder to share</p>
</div></li><li><span><span class="tsd-kind-parameter">hours</span>: <span class="tsd-signature-type">number</span></span><div class="tsd-comment tsd-typography"><p>The number of hours until the share link expires</p>
</div></li><li><span><span class="tsd-kind-parameter">origin</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The application's origin URL (e.g., &quot;<a href="https://example.com">https://example.com</a>&quot;)</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">url</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">expires_at</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Date</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to an object containing:</p>
<ul>
<li><code>url</code>: The complete shareable URL with the token</li>
<li><code>expires_at</code>: The Date when the share link will expire</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-5">Throws<a href="#throws-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>The folder is not found</li>
<li>The database update fails</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-6">Example<a href="#example-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Share a folder for 48 hours</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">shareInfo</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">shareFolder</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-6">&#39;folder-123&#39;</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-10">48</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-6">&#39;https://myapp.com&#39;</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Share this link:&#39;</span><span class="hl-2">, </span><span class="hl-7">shareInfo</span><span class="hl-2">.</span><span class="hl-7">url</span><span class="hl-2">);</span><br/><span class="hl-0">// Output: &quot;https://myapp.com/shared/folder/abc-def-ghi-123&quot;</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Expires at:&#39;</span><span class="hl-2">, </span><span class="hl-7">shareInfo</span><span class="hl-2">.</span><span class="hl-7">expires_at</span><span class="hl-2">);</span><br/><span class="hl-0">// Output: 2024-10-25T12:00:00.000Z</span><br/><br/><span class="hl-0">// Share for 7 days (168 hours)</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">weekShare</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">shareFolder</span><span class="hl-2">(</span><span class="hl-6">&#39;folder-456&#39;</span><span class="hl-2">, </span><span class="hl-10">168</span><span class="hl-2">, </span><span class="hl-7">origin</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-6">Remarks<a href="#remarks-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Security Features:</strong></p>
<ul>
<li>Generates a cryptographically secure random UUID as the share token</li>
<li>Token is stored in the database and validated on access</li>
<li>Links automatically expire after the specified time</li>
<li>The token is unguessable (UUID v4 = 122 bits of randomness)</li>
</ul>
<p><strong>Behavior:</strong></p>
<ul>
<li>Sets the folder's <code>shared</code> flag to <code>true</code></li>
<li>Generates a new <code>shareToken</code> (UUID)</li>
<li>Calculates <code>expires_at</code> as current time + hours</li>
<li>Returns a full URL: <code>{origin}/shared/folder/{shareToken}</code></li>
</ul>
<p><strong>Access Control:</strong></p>
<ul>
<li>Anyone with the share link can access the folder until expiration</li>
<li>No authentication required for accessing shared folders</li>
<li>All files within the folder hierarchy are accessible via the share token</li>
<li>See FileService.getFileFromShareToken for how files are accessed</li>
</ul>
<p><strong>Multiple Shares:</strong></p>
<ul>
<li>Sharing a folder again overwrites the previous share token</li>
<li>Consider implementing multiple concurrent shares if needed</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-4">See<a href="#see-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#getfolderbysharetoken" class="tsd-kind-method">getFolderByShareToken</a> for retrieving folders by their share token</li>
<li>FileService.getFileFromShareToken for file access via share tokens</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L676">src/services/folder-service.ts:676</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="uploadfiletofolder"><code class="tsd-tag">Static</code><span>upload<wbr/>File<wbr/>To<wbr/>Folder</span><a href="#uploadfiletofolder" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="uploadfiletofolder-1"><span class="tsd-kind-call-signature">uploadFileToFolder</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">root_folder</span><span class="tsd-signature-symbol">:</span> <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">curr_folder</span><span class="tsd-signature-symbol">:</span> <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">file</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">File</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">buffer</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">user</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">User</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.File.html" class="tsd-signature-type tsd-kind-type-alias">File</a> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">&gt;</span><a href="#uploadfiletofolder-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Uploads a file to S3 and creates a corresponding database record within a folder.</p>
<p>This method handles the complete file upload process: storing the file in S3,
creating a database record with metadata, and linking it to the parent folder.
The file is stored at the root folder level in S3 but tracked within the
current folder in the database hierarchy.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">root_folder</span>: <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a></span><div class="tsd-comment tsd-typography"><p>The user's root folder (used for S3 path construction)</p>
</div></li><li><span><span class="tsd-kind-parameter">curr_folder</span>: <a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a></span><div class="tsd-comment tsd-typography"><p>The folder where the file will be logically stored</p>
</div></li><li><span><span class="tsd-kind-parameter">file</span>: <span class="tsd-signature-type">File</span></span><div class="tsd-comment tsd-typography"><p>The browser File object containing metadata</p>
</div></li><li><span><span class="tsd-kind-parameter">buffer</span>: <span class="tsd-signature-type">Buffer</span></span><div class="tsd-comment tsd-typography"><p>The file's binary content as a Buffer</p>
</div></li><li><span><span class="tsd-kind-parameter">user</span>: <span class="tsd-signature-type">User</span></span><div class="tsd-comment tsd-typography"><p>The Clerk user object (owner of the file)</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.File.html" class="tsd-signature-type tsd-kind-type-alias">File</a> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to:</p>
<ul>
<li>The newly created File object with database metadata</li>
<li><code>null</code> if the upload fails (though typically throws an error instead)</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-6">Throws<a href="#throws-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>The S3 upload fails</li>
<li>The database file creation fails</li>
<li>The folder update to link the file fails</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-7">Example<a href="#example-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">formData</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">request</span><span class="hl-2">.</span><span class="hl-5">formData</span><span class="hl-2">();</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">file</span><span class="hl-2"> = </span><span class="hl-7">formData</span><span class="hl-2">.</span><span class="hl-5">get</span><span class="hl-2">(</span><span class="hl-6">&#39;file&#39;</span><span class="hl-2">) </span><span class="hl-4">as</span><span class="hl-2"> </span><span class="hl-8">File</span><span class="hl-2">;</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">arrayBuffer</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">file</span><span class="hl-2">.</span><span class="hl-5">arrayBuffer</span><span class="hl-2">();</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">buffer</span><span class="hl-2"> = </span><span class="hl-7">Buffer</span><span class="hl-2">.</span><span class="hl-5">from</span><span class="hl-2">(</span><span class="hl-7">arrayBuffer</span><span class="hl-2">);</span><br/><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">uploadedFile</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">uploadFileToFolder</span><span class="hl-2">(</span><br/><span class="hl-2">  </span><span class="hl-7">rootFolder</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">currentFolder</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">file</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">buffer</span><span class="hl-2">,</span><br/><span class="hl-2">  </span><span class="hl-7">user</span><br/><span class="hl-2">);</span><br/><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Uploaded:&#39;</span><span class="hl-2">, </span><span class="hl-7">uploadedFile</span><span class="hl-2">?.</span><span class="hl-7">file_name</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;S3 location:&#39;</span><span class="hl-2">, </span><span class="hl-7">uploadedFile</span><span class="hl-2">?.</span><span class="hl-7">s3_key</span><span class="hl-2">);</span><br/><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Size:&#39;</span><span class="hl-2">, </span><span class="hl-7">uploadedFile</span><span class="hl-2">?.</span><span class="hl-7">size</span><span class="hl-2">, </span><span class="hl-6">&#39;bytes&#39;</span><span class="hl-2">);</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-7">Remarks<a href="#remarks-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>S3 Storage:</strong></p>
<ul>
<li>Files are stored at: <code>{rootFolderName}/{fileName}</code></li>
<li>The content type from the browser File object is preserved</li>
<li>File overwrites are possible if the same name exists (no automatic versioning)</li>
</ul>
<p><strong>Database Record:</strong></p>
<ul>
<li>Stores: file_name, size, parent_folder_id, owner_clerk_id, s3_link, s3_key</li>
<li>Links to the current folder via <code>parent_folder_id</code></li>
<li>Links to the user via <code>owner_clerk_id</code></li>
<li>Timestamps are automatically added by Prisma</li>
</ul>
<p><strong>Folder Relationship:</strong></p>
<ul>
<li>The file is added to the folder's <code>files</code> relationship</li>
<li>This enables easy querying of all files in a folder</li>
</ul>
<p><strong>Limitations:</strong></p>
<ul>
<li>No duplicate name checking (last upload wins)</li>
<li>No virus scanning or content validation</li>
<li>No file size limit enforcement (should be done before calling)</li>
<li>All files go to root folder path regardless of subfolder depth</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-5">See<a href="#see-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#getfolder" class="tsd-kind-method">getFolder</a> to retrieve folders and their files</li>
<li>FileService.deleteFile to delete uploaded files</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L776">src/services/folder-service.ts:776</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="getancestors"><code class="tsd-tag">Static</code><span>get<wbr/>Ancestors</span><a href="#getancestors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="getancestors-1"><span class="tsd-kind-call-signature">getAncestors</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">folderId</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">user</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">User</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">id</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">name</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">[]</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">&gt;</span><a href="#getancestors-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Retrieves the breadcrumb trail of folders from the root to a specified folder.</p>
<p>This method traverses the folder hierarchy upward from a given folder to build
an array of ancestor folders. It's commonly used for generating breadcrumb
navigation showing the current folder's path.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">folderId</span>: <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span></span><div class="tsd-comment tsd-typography"><p>The folder ID to start from, or null to return just the root folder</p>
</div></li><li><span><span class="tsd-kind-parameter">user</span>: <span class="tsd-signature-type">User</span></span><div class="tsd-comment tsd-typography"><p>The Clerk user object containing the root folder ID in publicMetadata</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-symbol">{</span> <span class="tsd-kind-property">id</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">;</span> <span class="tsd-kind-property">name</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">}</span><span class="tsd-signature-symbol">[]</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">null</span><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to:</p>
<ul>
<li>An array of objects with <code>id</code> and <code>name</code> properties, ordered from root to current</li>
<li><code>null</code> if the specified folder doesn't exist</li>
</ul>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-7">Throws<a href="#throws-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if there's a database communication failure</p>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-8">Example<a href="#example-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Get breadcrumbs for a nested folder</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">ancestors</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getAncestors</span><span class="hl-2">(</span><span class="hl-6">&#39;folder-deep-nested&#39;</span><span class="hl-2">, </span><span class="hl-7">user</span><span class="hl-2">);</span><br/><br/><span class="hl-0">// Result: [</span><br/><span class="hl-0">//   { id: &#39;root-id&#39;, name: &#39;JohnDoe&#39; },</span><br/><span class="hl-0">//   { id: &#39;documents-id&#39;, name: &#39;Documents&#39; },</span><br/><span class="hl-0">//   { id: &#39;work-id&#39;, name: &#39;Work&#39; },</span><br/><span class="hl-0">//   { id: &#39;folder-deep-nested&#39;, name: &#39;Projects&#39; }</span><br/><span class="hl-0">// ]</span><br/><br/><span class="hl-0">// Render breadcrumbs</span><br/><span class="hl-7">ancestors</span><span class="hl-2">?.</span><span class="hl-5">forEach</span><span class="hl-2">((</span><span class="hl-7">ancestor</span><span class="hl-2">, </span><span class="hl-7">i</span><span class="hl-2">) </span><span class="hl-1">=&gt;</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">`</span><span class="hl-1">${</span><span class="hl-7">ancestor</span><span class="hl-11">.</span><span class="hl-7">name</span><span class="hl-1">}${</span><span class="hl-7">i</span><span class="hl-11"> </span><span class="hl-2">&lt;</span><span class="hl-11"> </span><span class="hl-7">ancestors</span><span class="hl-11">.</span><span class="hl-7">length</span><span class="hl-11"> </span><span class="hl-2">-</span><span class="hl-11"> </span><span class="hl-10">1</span><span class="hl-11"> </span><span class="hl-2">?</span><span class="hl-11"> </span><span class="hl-6">&#39; &gt; &#39;</span><span class="hl-11"> </span><span class="hl-2">:</span><span class="hl-11"> </span><span class="hl-6">&#39;&#39;</span><span class="hl-1">}</span><span class="hl-6">`</span><span class="hl-2">);</span><br/><span class="hl-2">});</span><br/><span class="hl-0">// Output: &quot;JohnDoe &gt; Documents &gt; Work &gt; Projects&quot;</span><br/><br/><span class="hl-0">// Get just the root folder</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">rootOnly</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getAncestors</span><span class="hl-2">(</span><span class="hl-1">null</span><span class="hl-2">, </span><span class="hl-7">user</span><span class="hl-2">);</span><br/><span class="hl-0">// Returns: [{ id: &#39;root-id&#39;, name: &#39;JohnDoe&#39; }]</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-8">Remarks<a href="#remarks-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Algorithm:</strong></p>
<ol>
<li>If <code>folderId</code> is null, returns just the root folder</li>
<li>Otherwise, starts from the specified folder</li>
<li>Traverses up the tree via <code>parent_folder_id</code></li>
<li>Collects each folder's id and name</li>
<li>Reverses the array to show root → current order</li>
</ol>
<p><strong>Performance:</strong></p>
<ul>
<li>Makes N database queries where N is the depth of the folder</li>
<li>For deeply nested folders, this can be slow</li>
<li>Consider caching or optimizing with a recursive CTE</li>
</ul>
<p><strong>Root Folder Access:</strong></p>
<ul>
<li>The root folder ID is retrieved from <code>user.publicMetadata.root_folder</code></li>
<li>This assumes the user's metadata has been properly set up</li>
</ul>
<p><strong>Use Cases:</strong></p>
<ul>
<li>Breadcrumb navigation in UI</li>
<li>Showing the current folder path</li>
<li>Validating folder access permissions</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-6">See<a href="#see-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#createrootfolder" class="tsd-kind-method">createRootFolder</a> which sets up the user's root folder</li>
<li><a href="#getfolder" class="tsd-kind-method">getFolder</a> for retrieving full folder details</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L883">src/services/folder-service.ts:883</a></li></ul></aside></div></li></ul></section><section class="tsd-panel tsd-member"><h3 class="tsd-anchor-link" id="getfolderbysharetoken"><code class="tsd-tag">Static</code><span>get<wbr/>Folder<wbr/>By<wbr/>Share<wbr/>Token</span><a href="#getfolderbysharetoken" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h3><ul class="tsd-signatures"><li class=""><div class="tsd-signature tsd-anchor-link" id="getfolderbysharetoken-1"><span class="tsd-kind-call-signature">getFolderByShareToken</span><span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">shareToken</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span><a href="#getfolderbysharetoken-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>Retrieves a folder using its unique share token.</p>
<p>This method is used to look up shared folders when users access them via
share links. It validates the share token and returns the folder if found.
Note: This method does NOT validate expiration - that should be done by the caller.</p>
</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">shareToken</span>: <span class="tsd-signature-type">string</span></span><div class="tsd-comment tsd-typography"><p>The unique share token (UUID) generated when the folder was shared</p>
</div></li></ul></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/types_types.Folder.html" class="tsd-signature-type tsd-kind-type-alias">Folder</a><span class="tsd-signature-symbol">&gt;</span></h4><p>A promise that resolves to the Folder object if found</p>
<div class="tsd-comment tsd-typography"><div class="tsd-tag-throws"><h4 class="tsd-anchor-link" id="throws-8">Throws<a href="#throws-8" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Error
Throws an error if:</p>
<ul>
<li>The database query fails</li>
<li>The folder is not found (returns null in current implementation, but this is inconsistent)</li>
</ul>
</div><div class="tsd-tag-example"><h4 class="tsd-anchor-link" id="example-9">Example<a href="#example-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-0">// Access a shared folder</span><br/><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">token</span><span class="hl-2"> = </span><span class="hl-6">&#39;abc-def-123-456&#39;</span><span class="hl-2">;</span><br/><br/><span class="hl-4">try</span><span class="hl-2"> {</span><br/><span class="hl-2">  </span><span class="hl-1">const</span><span class="hl-2"> </span><span class="hl-3">sharedFolder</span><span class="hl-2"> = </span><span class="hl-4">await</span><span class="hl-2"> </span><span class="hl-7">FolderService</span><span class="hl-2">.</span><span class="hl-5">getFolderByShareToken</span><span class="hl-2">(</span><span class="hl-7">token</span><span class="hl-2">);</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Check if the share has expired (must be done manually)</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (</span><span class="hl-7">sharedFolder</span><span class="hl-2">.</span><span class="hl-7">expires_at</span><span class="hl-2"> &amp;&amp; </span><span class="hl-7">sharedFolder</span><span class="hl-2">.</span><span class="hl-7">expires_at</span><span class="hl-2"> &lt; </span><span class="hl-1">new</span><span class="hl-2"> </span><span class="hl-5">Date</span><span class="hl-2">()) {</span><br/><span class="hl-2">    </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Share link has expired&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-0">// Check if sharing is still enabled</span><br/><span class="hl-2">  </span><span class="hl-4">if</span><span class="hl-2"> (!</span><span class="hl-7">sharedFolder</span><span class="hl-2">.</span><span class="hl-7">shared</span><span class="hl-2">) {</span><br/><span class="hl-2">    </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Folder is no longer shared&#39;</span><span class="hl-2">);</span><br/><span class="hl-2">    </span><span class="hl-4">return</span><span class="hl-2">;</span><br/><span class="hl-2">  }</span><br/><span class="hl-2">  </span><br/><span class="hl-2">  </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">log</span><span class="hl-2">(</span><span class="hl-6">&#39;Access granted to:&#39;</span><span class="hl-2">, </span><span class="hl-7">sharedFolder</span><span class="hl-2">.</span><span class="hl-7">folder_name</span><span class="hl-2">);</span><br/><span class="hl-2">} </span><span class="hl-4">catch</span><span class="hl-2"> (</span><span class="hl-7">error</span><span class="hl-2">) {</span><br/><span class="hl-2">  </span><span class="hl-7">console</span><span class="hl-2">.</span><span class="hl-5">error</span><span class="hl-2">(</span><span class="hl-6">&#39;Invalid share token:&#39;</span><span class="hl-2">, </span><span class="hl-7">error</span><span class="hl-2">);</span><br/><span class="hl-2">}</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-tag-remarks"><h4 class="tsd-anchor-link" id="remarks-9">Remarks<a href="#remarks-9" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Important: Manual Validation Required</strong></p>
<p>This method only retrieves the folder - it does NOT:</p>
<ul>
<li>Check if the share has expired (<code>expires_at</code>)</li>
<li>Verify the <code>shared</code> flag is still true</li>
<li>Validate any permissions</li>
</ul>
<p>Callers MUST implement these checks to ensure secure access.</p>
<p><strong>Typical Usage Flow:</strong></p>
<ol>
<li>User clicks share link with token in URL</li>
<li>Frontend extracts token from URL</li>
<li>Backend calls this method to get the folder</li>
<li>Backend validates <code>expires_at</code> and <code>shared</code> flag</li>
<li>If valid, grant access to folder contents</li>
<li>Use FileService.getFileFromShareToken for file access</li>
</ol>
<p><strong>Security Considerations:</strong></p>
<ul>
<li>Share tokens are cryptographically random UUIDs (secure)</li>
<li>Tokens don't expire automatically - must be checked manually</li>
<li>Revoking a share requires setting <code>shared = false</code> or changing the token</li>
</ul>
</div><div class="tsd-tag-see"><h4 class="tsd-anchor-link" id="see-7">See<a href="#see-7" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><a href="#sharefolder" class="tsd-kind-method">shareFolder</a> which generates the share token</li>
<li>FileService.getFileFromShareToken for accessing files via share tokens</li>
</ul>
</div></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/MarwanBit/file-uploader-nextjs/blob/ebf65e9978cac76d70d9b3f8dca33f8c4c4a983b/src/services/folder-service.ts#L988">src/services/folder-service.ts:988</a></li></ul></aside></div></li></ul></section></section></details></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Constructors"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Constructors</summary><div><a href="#constructor"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Constructor"><use href="../assets/icons.svg#icon-512"></use></svg><span>constructor</span></a></div></details><details open class="tsd-accordion tsd-page-navigation-section"><summary class="tsd-accordion-summary" data-key="section-Methods"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Methods</summary><div><a href="#createrootfolder"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>create<wbr/>Root<wbr/>Folder</span></a><a href="#getfolder"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder</span></a><a href="#createsubfolder"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>create<wbr/>Subfolder</span></a><a href="#getfolderrecursively"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder<wbr/>Recursively</span></a><a href="#deletefolderrecursively"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>delete<wbr/>Folder<wbr/>Recursively</span></a><a href="#sharefolder"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>share<wbr/>Folder</span></a><a href="#uploadfiletofolder"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>upload<wbr/>File<wbr/>To<wbr/>Folder</span></a><a href="#getancestors"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Ancestors</span></a><a href="#getfolderbysharetoken"><svg class="tsd-kind-icon" viewBox="0 0 24 24" aria-label="Method"><use href="../assets/icons.svg#icon-2048"></use></svg><span>get<wbr/>Folder<wbr/>By<wbr/>Share<wbr/>Token</span></a></div></details></div></details></div><div class="site-menu"><nav id="tsd-sidebar-links" class="tsd-navigation"><a href="https://github.com/marwanbit/file-uploader-nextjs" class="tsd-nav-link">GitHub</a></nav><nav class="tsd-navigation"><a href="../modules.html">File Uploader Next.js - API Documentation - v0.1.0</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
